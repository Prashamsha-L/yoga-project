<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Yoga Session Results</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    :root{
      --bg:#f5fff5;
      --card:#ffffff;
      --muted:#666;
      --accent:#4caf50;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Arial, Helvetica, sans-serif;
      background:var(--bg);
      padding:18px;
    }

    h1{text-align:center;margin-bottom:20px}

    .top{
      display:flex;
      justify-content:center;
      margin-bottom:20px;
    }

    .overall-card{
      background:var(--card);
      padding:16px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      text-align:center;
      min-width:260px;
    }

    .main{
      max-width:1300px;
      margin:0 auto;
      display:grid;
      grid-template-columns:1fr 560px;
      gap:30px;
    }

    .pose-list,.suggestions{
      background:var(--card);
      border-radius:10px;
      padding:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      max-height:75vh;
      overflow-y:auto;
    }

    .section-title{
      font-weight:700;
      text-align:center;
      margin-bottom:14px;
      font-size:18px;
    }

    .pose-card{
      display:flex;
      gap:12px;
      border:1px solid #eee;
      border-radius:8px;
      padding:10px;
      margin-bottom:10px;
      align-items:center;
    }

    .pose-img{
      width:90px;
      height:90px;
      object-fit:contain;
      border-radius:6px;
      background:#f8f8f8;
      padding:5px;
    }

    .pose-info{flex:1}

    .pose-name{
      font-weight:700;
      margin-bottom:6px;
    }

    .progress-wrap{
      height:18px;
      background:#eee;
      border-radius:6px;
      overflow:hidden;
    }

    .progress-fill{
      height:100%;
      transition:width .4s;
    }

    .pose-right{
      width:60px;
      text-align:right;
      font-weight:700;
    }

    .suggestions .item{
      background:#fafafa;
      padding:10px;
      border-radius:8px;
      border:1px solid #eee;
      margin-bottom:10px;
    }

    .heading{
      font-weight:700;
      margin:14px 0 6px;
    }

    .bad{border-left:5px solid red}
    .mid{border-left:5px solid orange}
    .good{border-left:5px solid green}

    .pose-title{
      font-weight:700;
      margin-bottom:4px;
    }

    .pose-tip{
      color:#444;
      font-size:14px;
    }

    .button-row{
      display:flex;
      justify-content:center;
      gap:16px;
      margin:30px 0;
    }

    .button-row button{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }

    @media(max-width:1000px){
      .main{grid-template-columns:1fr}
    }
    /* ---------- Image Modal ---------- */
#imgModal{
  position:fixed;
  top:0; left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#imgModal img{
  display:block;
  max-width:90vw;
  max-height:90vh;
  width:auto;
  height:auto;
  background:none;
  border-radius:12px;
  box-shadow:0 15px 40px rgba(0,0,0,0.6);
  transform:scale(1);
}

#closeModal{
  position:absolute;
  top:20px;
  right:30px;
  font-size:40px;
  color:#fff;
  cursor:pointer;
  font-weight:bold;
}
.pose-img{
  cursor: zoom-in;
}

#imgModal img{
  animation: zoomIn 0.3s ease-out;
}

@keyframes zoomIn{
  from{
    transform:scale(0.7);
    opacity:0;
  }
  to{
    transform:scale(1);
    opacity:1;
  }
}


  </style>
</head>

<body>

<h1>Yoga Session Results</h1>

<div class="top">
  <div class="overall-card">
    <h3>Overall Accuracy</h3>
    <canvas id="overallChart" width="180" height="180"></canvas>
    <div id="overallText"></div>
  </div>
</div>

<div class="main">
  <div class="pose-list">
    <div class="section-title">Pose-wise Performance</div>
    <div id="poseContainer"></div>
  </div>

  <aside class="suggestions">
    <div class="section-title">Insights & Corrections</div>
    <div id="summaryBlock"></div>
  </aside>
</div>

<div class="button-row">
  <button onclick="location.href='home.html'">Back to Home</button>
  <button onclick="clearSession()">Clear</button>
</div>

<script>
/* ---------- Helpers ---------- */
function safeParse(v){ try{return JSON.parse(v||'{}')}catch(e){return{}} }
function avg(arr){ return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0 }
function clamp(v){ return Math.max(0,Math.min(100,v)) }
function colorFor(v){ return v<=50?'red':v<80?'orange':'green' }
function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)] }

/* ---------- Pose Image Map (WITH BRACKETS) ---------- */
const poseImageMap = {
  // ---------- Beginner ----------
  "Adho Mukha Svanasana (Downward Dog Pose)": "Yoga_images/b1.jpeg",
  "Ananda Balasana (Happy Baby Pose)": "Yoga_images/b2.jpeg",
  "Anjaneyasana (Low Lunge Pose)": "Yoga_images/b3.jpeg",
  "Ardha Chakrasana (Half Wheel Pose)": "Yoga_images/b4.jpeg",
  "Ardha Uttanasana (Half Forward Bend)": "Yoga_images/b5.jpeg",
  "Baddha Konasana (Bound Angle Pose / Butterfly)": "Yoga_images/b6.jpeg",
  "Balasana (Child’s Pose)": "Yoga_images/b7.jpeg",
  "Bhujangasana (Cobra Pose)": "Yoga_images/b8.jpeg",
  "Bitilasana (Cow Pose)": "Yoga_images/b9.jpeg",
  "Dandasana (Staff Pose)": "Yoga_images/b10.jpeg",
  "Marjariasana (Cat Pose)": "Yoga_images/b11.jpeg",
  "Paripurna Navasana (Full Boat Pose)": "Yoga_images/b12.jpeg",
  "Tadasana Samasthiti (Mountain Pose)": "Yoga_images/b13.jpeg",
  "Tadasana Urdhva Baddha Hastasana (Raised Hands Mountain Pose)": "Yoga_images/b14.jpeg",
  "Tadasana Urdhva Hastasana (Upward Mountain Pose)": "Yoga_images/b15.jpeg",
  "Utthita Hasta Padasana (Extended Hand to Foot Pose)": "Yoga_images/b17.jpeg",
  "Utthita Trikonasana (Extended Triangle Pose)": "Yoga_images/b18.jpeg",
  "Vajrasana (Thunderbolt Pose)": "Yoga_images/b19.jpeg",
  "Virabhadrasana I (Warrior I Pose)": "Yoga_images/b20.jpeg",
  "Virabhadrasana II (Warrior II Pose)": "Yoga_images/b21.jpeg",

  // ---------- Intermediate ----------
  "Anantasana (Side Reclining Leg Lift)": "Yoga_images/i1.jpeg",
  "Ardha Chandrasana (Half Moon Pose)": "Yoga_images/i2.jpeg",
  "Ardha Matsyendrasana (Half Spinal Twist)": "Yoga_images/i3.jpeg",
  "Dhanurasana (Bow Pose)": "Yoga_images/i4.jpeg",
  "Malasana (Garland Pose)": "Yoga_images/i5.jpeg",
  "Natarajasana (Dancer Pose)": "Yoga_images/i6.jpeg",
  "Padmasana (Lotus Pose)": "Yoga_images/i7.jpeg",
  "Parighasana (Gate Pose)": "Yoga_images/i8.jpeg",
  "Parivritta Trikonasana (Revolved Triangle Pose)": "Yoga_images/i9.jpeg",
  "Phalakasana (Plank Pose)": "Yoga_images/i10.jpeg",
  "Setu Bandha Sarvangasana (Bridge Pose)": "Yoga_images/i11.jpeg",
  "Utkatasana (Chair Pose)": "Yoga_images/i12.jpeg",
  "Utkata Konasana (Goddess Pose)": "Yoga_images/i13.jpeg",
  "Urdhva Dhanurasana (Wheel Pose)": "Yoga_images/i14.jpeg",
  "Uttana Shishosana (Extended Puppy Pose)": "Yoga_images/i15.jpeg",
  "Uttanasana (Standing Forward Bend)": "Yoga_images/i16.jpeg",
  "Vrkshasana":"Yoga_images/vrk.jpeg",

  // ---------- Advanced ----------
  "Gomukhasana (Cow Face Pose)": "Yoga_images/a1.jpeg",
  "Halasana (Plow Pose)": "Yoga_images/a2.jpeg",
  "Kapotasana (Pigeon Pose)": "Yoga_images/a3.jpeg",
  "Mayurasana (Peacock Pose)": "Yoga_images/a4.jpeg",
  "Svarga Dvidasana (Bird of Paradise Pose)": "Yoga_images/a5.jpeg",
  "Tittibhasana (Firefly Pose)": "Yoga_images/a6.jpeg",
  "Utthita Hasta Padangusthasana (Extended Hand to Big Toe Pose)": "Yoga_images/a7.jpeg",
  "Urdhva Dandasana (Upward Staff Pose)": "Yoga_images/a8.jpeg",
  "Vasisthasana (Side Plank Pose)": "Yoga_images/a9.jpeg",
  "Virabhadrasana III (Warrior III Pose)": "Yoga_images/a10.jpeg",
  "Visvamitrasana (Visvamitra’s Pose)": "Yoga_images/a11.jpeg",
  "Vrichikasana (Scorpion Pose)": "Yoga_images/a12.jpeg"
};


/* ---------- Normalize Pose Name (REMOVE BRACKETS) ---------- */
function normalizePose(name){
  return name.replace(/\s*\(.*?\)\s*/g,'').trim().toLowerCase();
}

/* ---------- Find Matching Image ---------- */
function getPoseImage(poseName){
  const cleanName = normalizePose(poseName);
  for(const key in poseImageMap){
    if(normalizePose(key) === cleanName){
      return poseImageMap[key];
    }
  }
  return "Yoga images/default.jpeg";
}

/* ---------- Load Results ---------- */
function loadSessionResults(){
  const raw = safeParse(sessionStorage.getItem('sessionResults'));
  const out = {};
  for(const p in raw){
    out[p]={ avg:avg(raw[p].map(v=>clamp(v))) };
  }
  return out;
}

/* ---------- Overall Chart ---------- */
function renderOverall(data){
  const values = Object.values(data).map(d=>d.avg);
  const overall = avg(values);

  new Chart(document.getElementById('overallChart'),{
    type:'doughnut',
    data:{datasets:[{data:[overall,100-overall],backgroundColor:['#4caf50','#eee']}]},
    options:{cutout:'70%',plugins:{legend:{display:false}}}
  });

  document.getElementById('overallText').textContent =
    Math.round(overall)+'% overall accuracy';

  return overall;
}

/* ---------- Pose Cards ---------- */
function renderPoseCards(data){
  const c=document.getElementById('poseContainer');
  c.innerHTML='';

  Object.keys(data).forEach(p=>{
    const pct=Math.round(data[p].avg);
    const imgSrc=getPoseImage(p);

    c.innerHTML+=`
      <div class="pose-card">
        <img src="${imgSrc}" 
     class="pose-img" 
     alt="${p}"
     onclick="openImage('${imgSrc}')">
        <div class="pose-info">
          <div class="pose-name">${p}</div>
          <div class="progress-wrap">
            <div class="progress-fill" style="width:${pct}%;background:${colorFor(pct)}"></div>
          </div>
        </div>
        <div class="pose-right">${pct}%</div>
      </div>`;
  });
}
const poorTips = [
  "Focus on correct body alignment and slow down the movement.",
  "Maintain steady breathing and avoid rushing into the pose.",
  "Use props or support if needed to improve stability.",
  "Engage the core muscles to avoid unnecessary strain.",
  "Practice this pose in front of a mirror for better posture awareness."
];

const midTips = [
  "Good effort—refine joint angles for better balance.",
  "Work on holding the pose longer with controlled breathing.",
  "Increase body awareness and muscle engagement.",
  "Practice smooth transitions into and out of the pose.",
  "Small posture adjustments can significantly improve accuracy."
];

const goodTips = [
  "Excellent posture—maintain this consistency.",
  "Try increasing hold duration to build endurance.",
  "Focus on breath synchronization with movement.",
  "You can attempt advanced variations of this pose.",
  "Great control and balance—keep up the disciplined practice."
];

/* ---------- Utility ---------- */
function randomFrom(arr){
  return arr[Math.floor(Math.random() * arr.length)];
}

/* ---------- Suggestions ---------- */
function generateSuggestions(data, overall){
  const good = [], mid = [], bad = [];

  for(const p in data){
    const score = data[p].avg;

    if(score <= 50){
      bad.push({
        pose: p,
        tip: randomFrom(poorTips)
      });
    }
    else if(score < 80){
      mid.push({
        pose: p,
        tip: randomFrom(midTips)
      });
    }
    else{
      good.push({
        pose: p,
        tip: randomFrom(goodTips)
      });
    }
  }

  let overallMsg = "Needs more practice.";
  if(overall >= 80) overallMsg = "Excellent session with strong posture control.";
  else if(overall >= 60) overallMsg = "Good session—focus on improving weaker poses.";

  return { good, mid, bad, overallMsg };
}


/* ---------- Render Suggestions ---------- */
function renderSuggestionsBlock(data, overall){
  const root = document.getElementById('summaryBlock');
  root.innerHTML = '';

  const { overallMsg, good, mid, bad } = generateSuggestions(data, overall);

  // Session summary
  root.innerHTML += `
    <div class="item">
      <strong>Session Summary</strong>
      <div>${overallMsg}</div>
    </div>
  `;

  // Poor poses
  if(bad.length){
    root.innerHTML += `<div class="heading">Needs Improvement</div>`;
    bad.forEach(i=>{
      root.innerHTML += `
        <div class="item bad">
          <div class="pose-title">${i.pose}</div>
          <div class="pose-tip">${i.tip}</div>
        </div>
      `;
    });
  }

  // Average poses
  if(mid.length){
    root.innerHTML += `<div class="heading">Can Be Better</div>`;
    mid.forEach(i=>{
      root.innerHTML += `
        <div class="item mid">
          <div class="pose-title">${i.pose}</div>
          <div class="pose-tip">${i.tip}</div>
        </div>
      `;
    });
  }

  // Good poses
  if(good.length){
    root.innerHTML += `<div class="heading">Well Done</div>`;
    good.forEach(i=>{
      root.innerHTML += `
        <div class="item good">
          <div class="pose-title">${i.pose}</div>
          <div class="pose-tip">${i.tip}</div>
        </div>
      `;
    });
  }
}


/* ---------- Clear ---------- */
function clearSession(){
  if(confirm('Clear session data?')){
    sessionStorage.clear();
    location.reload();
  }
}

/* ---------- Init ---------- */
window.addEventListener('DOMContentLoaded', () => {

  const data = loadSessionResults();
  const overall = renderOverall(data);
  renderPoseCards(data);
  renderSuggestionsBlock(data, overall);

  // ---------- Modal Controls ----------
  const modal = document.getElementById('imgModal');
  const closeBtn = document.getElementById('closeModal');

  closeBtn.onclick = () => {
    modal.style.display = 'none';
  };

  modal.onclick = (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  };
});

/* ---------- Image Zoom ---------- */
function openImage(src){
  const modal = document.getElementById('imgModal');
  const img = document.getElementById('modalImg');

  img.onload = () => {
    modal.style.display = 'flex';
  };

  img.onerror = () => {
    alert("Image not found: " + src);
  };

  img.src = src;
}


// document.getElementById('closeModal').onclick = () => {
//   document.getElementById('imgModal').style.display = 'none';
// };

// document.getElementById('imgModal').onclick = (e) => {
//   if(e.target.id === 'imgModal'){
//     e.currentTarget.style.display = 'none';
//   }
// };

</script>
<div id="imgModal" style="display:none">
  <span id="closeModal">&times;</span>
  <img id="modalImg">
</div>
</body>
</html>
